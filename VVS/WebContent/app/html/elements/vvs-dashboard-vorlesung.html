<polymer-element name="vvs-dashboard-vorlesung">
	<template>
 		<link rel="stylesheet" href="../../css/elements.css" shim-shadowdom>
		<!-- Main DIV -->
		<paper-shadow z="3" class="shadow">
			<div horizontal layout>
				<div vertical layout class="vertical-input">
					<span class="headline">
						<div vertical layout>
							<div horizontal layout center>
								<core-icon class="icon-good" icon="arrow-back" on-click="{{back}}" hidden?="{{semester===1}}"></core-icon>
								<span>{{kurs.kursname}} - {{semester}}. Semester</span>
								<core-icon class="icon-good" icon="arrow-forward" on-click="{{forward}}" hidden?="{{semester===6}}"></core-icon>
							</div>
						</div>
					</span>
					<div horizontal layout center class="flex-container">
					<!-- bestehende Vorlesungen -->
						<template repeat="{{item in vorlesungen}}">
							<paper-shadow z="2" class="inner-shadow flex-item" on-click="{{navigate}}">
								<div class="margin">
									<div class="small-headline-dashboard">{{item.vorlesung.fachInstanz.fach.name}}</div>
									<div class="flex-item-item" horizontal layout center>
										<span class="text-width">geplante Stunden:</span>
										<paper-progress class="progress-dashboard" value="{{item.geplanteStunden/item.vorlesung.fachInstanz.stunden}}"></paper-progress>
									</div>
									<div class="flex-item-item" horizontal layout center-center>
										<span class="text-width">Dozent ausgew&auml;hlt:</span>
										<core-icon class="icon-good" icon="check-box" hidden?="{{item.vorlesung.dozent>0}}" flex></core-icon>
										<core-icon class="icon-bad" icon="cancel" hidden?="{{!item.vorlesung.dozent>0}}" flex></core-icon>
									</div>
									<div class="flex-item-item" horizontal layout center-center>
										<span class="text-width">Klausur festgelegt:</span>
										<core-icon class="icon-good" icon="check-box" hidden?="{{!item.geplanteKlausur}}" flex></core-icon>
										<core-icon class="icon-bad" icon="cancel" hidden?="{{item.geplanteKlausur}}" flex></core-icon>
									</div>
								</div>
							</paper-shadow>
						</template>
						<!-- neue Vorlesung -->
						<paper-shadow z="2" class="inner-shadow flex-item" on-click="{{add}}">
							<div horizontal layout center-center fit>
								<core-icon class="icon-neutral" icon="add-circle-outline" flex></core-icon>
							</div>
						</paper-shadow>	
					</div>
				</div>
			</div>
		</paper-shadow>
		<vvs-vorlesungs-overlay id="vorlesungsOverlay" kurs="{{kurs}}" semester="{{semester}}" toasts="{{toasts}}" createdVorlesungen="{{createdVorlesungen}}"></vvs-vorlesungs-overlay>
	</template>
		<script type="text/javascript">
		"use strict";
		Polymer('vvs-dashboard-vorlesung',
			{
				vorlesungen: [],
				kurs: new model.templates.Kurs(),
				semester: 0,
				createdVorlesungen: false,
				//Publish those attributes to home
				publish: {
					pageParameter: {},
					pageLoaded: {},
					toasts: {}
				},
				//Initialize the screen
				ready : function() {
					var self = this;
					self.vorlesungen = [];
					//ID is correct, needs to be named like this for other functions
					//TODO Parameter aus Kursdashboard übergeben
					self.kurs = new model.templates.Kurs();
					self.kurs.id = 9;
					self.kurs.kursname = "WWI12SEA";
					self.semester = 3;
					self.load();
				},
				load: function() {
					var self = this;
					model.webService.getAllVorlesungenSemester(self.kurs, self.semester, function(api) {
						if (!api.isError)
	   					{
	   						self.vorlesungen = api.response;
	   						self.disableToggle = false;
	   					}
	   					else
	   					{
	   						console.log(JSON.stringify(api));
	   						self.toasts.error.show();
	   					}
					}
					);
				},
				//Navigate to Planung for selected Vorlesung
				navigate: function(e, detail, sender) {
					var self = this;
					self.pageLoaded.planung = false;
					location.href = "#!planung" + "-" + sender.templateInstance.model.item.vorlesung.id;
				},
				//Navigate to Vorlesungsdashboard of previous semester
				back: function () {
					var self = this;
					var previousSemester = self.semester - 1;
					self.pageLoaded.vdashboard = false;
					location.href = "#!vdashboard" + "-" + kurs + "-" + previousSemester;
				},
				//Navigate to Vorlesungsdashboard of next semester
				forward: function() {
					var self = this;
					var nextSemester = self.semester + 1;
					self.pageLoaded.vdashboard = false;
					location.href = "#!vdashboard" + "-" + kurs + "-" + nextSemester;
				},
				//Add new Vorlesungen
				add: function() {
					this.$.vorlesungsOverlay.toggle();
				},
				//Reload dashboard, if vorlesungsOverlay is closed and vorlesungen have been added
				createdVorlesungenChanged: function() {
					if(this.createdVorlesungen === true) {
						this.load();
					}
				}
		});
	</script>
</polymer-element>