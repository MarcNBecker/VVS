<polymer-element name="vvs-dashboard-studiengangsleiter">
	<template>
 		<link rel="stylesheet" href="../../css/elements.css" shim-shadowdom>
		<!-- Main DIV -->
		<paper-shadow z="3" class="shadow">
			<div horizontal layout>
				<div vertical layout class="vertical-input">
					<span class="headline" disabled="{{disableToggle}}">Kurs&uuml;bersicht f&uuml;r {{studiengangsleiter.name}}</span>
					<div horizontal layout center class="flex-container">
					<!-- bestehende Kurse -->
						<template repeat="{{item in kurse}}">
							<paper-shadow z="2" class="inner-shadow flex-item" on-click="{{navigate}}">
								<div class="margin">
									<div class="flex-item-item small-headline-dashboard-sl" horizontal layout center-center>
										<span>{{item.kurs.kursname}} - {{item.planBlocklage.semester}}. Semester</span>
									</div>
									<div class="flex-item-item" horizontal layout center-center>{{item.planBlocklage.startDatum}} bis {{item.planBlocklage.endDatum}}</div>
									<div class="flex-item-item" horizontal layout center>
										<span class="text-width-sl">ausgew&auml;hlte Vorlesungen:</span>
										<span flex>{{item.geplanteVorlesungen}}</span>
									</div>
									<div class="flex-item-item" horizontal layout center>
										<span class="text-width-sl">geplante Stunden:</span>
										<paper-progress class="progress-dashboard-sl" value="{{(item.geplanteStunden/item.gesamteStunden)*100}}"></paper-progress>
									</div>
									<div class="flex-item-item" horizontal layout center>
										<span class="text-width-sl">fehlende Dozenten:</span>
										<span flex>{{item.fehlendeDozenten}}</span>
									</div>
									<div class="flex-item-item" horizontal layout center>
										<span class="text-width-sl">fehlende Klausuren:</span>
										<span flex>{{item.fehlendeKlausuren}}</span>
									</div>
								</div>
							</paper-shadow>
						</template>
						<!-- neuer Kurs -->
						<paper-shadow z="2" class="inner-shadow flex-item" on-click="{{add}}">
							<div horizontal layout center-center fit>
								<core-icon class="icon-neutral" icon="add-circle-outline" flex></core-icon>
							</div>
						</paper-shadow>	
					</div>
				</div>
			</div>
		</paper-shadow>
	</template>
		<script type="text/javascript">
		"use strict";
		Polymer('vvs-dashboard-studiengangsleiter',
			{
				kurse: [],	
				studiengangsleiter: new model.templates.Studiengangsleiter(),
				disableToggle: false,
				//Publish those attributes to home
				publish: {
					user: {},
					pageLoaded: {},
					toasts: {}
				},
				//Initialize the screen
				ready : function() {
					var self = this;
					self.kurse = [];
					self.studiengangsleiter = new model.templates.Studiengangsleiter();
					self.studiengangsleiter.id = self.user.repraesentiert;
					self.disableToggle = true;
					//Load selected Studiengangsleiter
					model.webService.getStudiengangsleiter(self.studiengangsleiter, function(api) {
						if (!api.isError)
	   					{
	   						self.studiengangsleiter = api.response;
	   						self.disableToggle = false;
	   					}
	   					else
	   					{
	   						console.log(JSON.stringify(api));
	   						self.toasts.error.show();
	   					}
					});
					self.load();
				},
				//Load all available Kurse of Studiengangsleiter
				load: function() {
					var self = this;
					self.disableToggle = true;
					model.webService.getStudiengangsleiterDashboard(self.studiengangsleiter, function(api) {
						if (!api.isError)
	   					{
	   						self.kurse = api.response;
	   						self.disableToggle = false;
	   					}
	   					else
	   					{
	   						console.log(JSON.stringify(api));
	   						self.toasts.error.show();
	   					}
					});
				},
				//Navigate to Vorlesungsdashboard for selected Kurs
				navigate: function(e, detail, sender) {
					var self = this;
					self.pageLoaded.vdashboard = false;
					location.href = "#!vdashboard" + "-" + sender.templateInstance.model.item.kurs.id + "-" + sender.templateInstance.model.item.planBlocklage.semester;
				},
				//Add new Kurs
				add: function() {
					if (this.disableToggle)
					{
						return;
					}
					location.href = "#!kurs";
				},
				//Reload dashboard, if kursOverlay is closed and kurse have been added
				createdKurseChanged: function() {
					if(this.createdKurse === true) {
						this.load();
					}
				}
		});
	</script>
</polymer-element>