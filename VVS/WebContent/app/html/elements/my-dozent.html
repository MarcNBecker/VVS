<link rel="import" href="../../polymer/polymer/polymer.html">
<link rel="import" href="../../polymer/paper-elements/paper-elements.html">
<link rel="import" href="../../polymer/core-elements/core-elements.html">

<polymer-element name="my-dozent">
	<template>
		<link rel="stylesheet" type="text/css" href="../formate.css">
		<div>
			<div id="dozentendaten" style="padding:10px; width:50%; border:1px black solid; float:left">
				<form>
					<paper-input-decorator id="titel" label="Titel" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.titel}}>
					</paper-input-decorator>
					<paper-dropdown-menu for label="Anrede" labelVisible floatingLabel required style="width:49%">
						<paper-dropdown class="dropdown">
							<core-menu class="menu" selected={{dozent.geschlecht}}>
								<template  repeat="{{item in geschlecht}}">
									<paper-item>{{item}}</paper-item>
								</template>
							</core-menu>
						</paper-dropdown>
					</paper-dropdown-menu>
					<paper-input-decorator id="name" label="Name" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.name}} required>
					</paper-input-decorator>
					<paper-input-decorator id="vorname" label="Vorname" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.vorname}} required>
					</paper-input-decorator>
					<paper-input-decorator id="strasse" label="Stra&szlig;e" labelVisible floatingLabel style="width:49%">
						<input is="core-input" value={{dozent.strasse}} required>
					</paper-input-decorator>
					<paper-input-decorator id="postleitzahl" label="PLZ" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.postleitzahl}} required>
					</paper-input-decorator>
					<paper-input-decorator id="wohnort" label="Wohnort" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.wohnort}} required>
					</paper-input-decorator>
					<paper-input-decorator id="mail" label="E-Mail" labelVisible floatingLabel style=" width:49%">
						<input is="core-input" value={{dozent.mail}} required>
					</paper-input-decorator>
					<paper-input-decorator id="telefonPrivat" label="Telefon (privat)" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.telefonPrivat}} required>
					</paper-input-decorator>
					<paper-input-decorator id="telefonGeschaeftlich" label="Telefon (gesch&auml;ftlich)" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.telefonGeschaeftlich}}>
					</paper-input-decorator>
					<paper-input-decorator id="telefonMobil" label="Telefon (mobil)" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input" value={{dozent.telefonMobil}}>
					</paper-input-decorator>
					<paper-input-decorator id="fax" label="Fax" labelVisible floatingLabel style="display:inline-block; width:49%">
						<input is="core-input"  value={{dozent.fax}}>
					</paper-input-decorator>
					<paper-input-decorator id="arbeitgeber" label="Arbeitgeber" labelVisible floatingLabel style="width:49%">
						<input is="core-input" value={{dozent.arbeitgeber}}>
					</paper-input-decorator>
					<paper-dropdown-menu label="Status" labelVisible floatingLabel required style="width:49%">
						<paper-dropdown class="dropdown">
							<core-menu class="menu" selected={{dozent.status}}>
								<template  repeat="{{item in status}}">
									<paper-item>{{item}}</paper-item>
								</template>
							</core-menu>
						</paper-dropdown>
					</paper-dropdown-menu>
					<div id="historie">
						<hr>
						<paper-input-decorator id="angelegt" label="angelegt am" labelVisible floatingLabel style="display:inline-block; width:49%">
							<input is="core-input" value="{{dozent.angelegt}}" disabled>
						</paper-input-decorator>
						<paper-input-decorator id="bearbeitet" label="bearbeitet am" labelVisible floatingLabel style="display:inline-block; width:49%">
							<input is="core-input" value="{{dozent.geaendert}}" disabled>
						</paper-input-decorator>
					</div>
				</form>
			</div>
			<div style="float:right; width:45%">
				<div style="padding:10px; border: 1px black solid">
					<h3>Kompetenzf&auml;cher</h3>
					<hr>
					<div id="kompetenzfaecher">
						<template  repeat="{{item in dozentenfaecher}}">
							<span>
							<paper-item style="display:inline-block">{{item.name}}</paper-item>
							<paper-icon-button icon="clear" on-click={{deleteFach}}></paper-icon-button>
							<br />
							</span>
						</template>
					</div>
					<hr>
					<paper-dropdown-menu label="Kompetenzfach">
						<paper-dropdown id="drop" class="dropdown">
							<core-menu id="fach" class="menu">
								<template  repeat="{{item in faecher}}">
									<paper-item>{{item.name}}</paper-item>
								</template>
							</core-menu>
						</paper-dropdown>
					</paper-dropdown-menu>
					<paper-button on-click={{addFach}} raised>+</paper-button>
				</div>
				<br />
				<br />
			</div>
		</div>
		<span id="buttons_anzeigen" style="padding-left:40px">
		<paper-button id="speichern" on-click={{speichern}} raised>Speichern</paper-button>
		<paper-button on-click={{loeschen}} raised>L&ouml;schen</paper-button>
		<paper-button on-click={{abbrechen]] raised>Abbrechen</paper-button>
		</span>
		<span id="buttons_anlegen" style="padding-left:40px">
		<paper-button id="speichern" on-click={{anlegen}} raised>Anlegen</paper-button>
		<paper-button on-click={{abbrechen]] raised>Abbrechen</paper-button>
		</span>
	</template>
	<script type="text/javascript" src="../../js/model.js"></script>
	<script type="text/javascript">
		Polymer('my-dozent', {
			dozent: new model.templates.Dozent(),
			fach: new model.templates.Fach(),
			geschlecht: [],
			status: [],
			dozentenfaecher: [],
			faecher: [],
    		ready: function()
    		{
    			var self = this;
    			var zeigeDozent = new model.templates.Dozent();
    			zeigeDozent.id = 1;  // muss noch durch Data Binding ersetzt werden
    			if (zeigeDozent.id === 0)
    			{
    				self.$.buttons_anzeigen.style.display = "none";
    				self.$.historie.style.display = "none";
    				model.webService.getAllFaecher(function(api) {
    					if (!api.error)
    						{
    						self.faecher = api.response;
    					}
    					else
    					{
    						console.log(JSON.stringify(api));
    					}
    				});	
    			}
    			else
    			{
    				self.$.buttons_anlegen.style.display = "none";
    				model.webService.getDozent(zeigeDozent, function(api) {
    					if (!api.error)
    					{
    						self.dozent = api.response;
    						self.$.titel.focusAction();
    						self.$.name.focusAction();
    						self.$.vorname.focusAction();
    						self.$.strasse.focusAction();
    						self.$.postleitzahl.focusAction();
    						self.$.wohnort.focusAction();
    						self.$.mail.focusAction();
    						self.$.telefonPrivat.focusAction();
    						self.$.telefonGeschaeftlich.focusAction();
    						self.$.telefonMobil.focusAction();
    						self.$.fax.focusAction();
    						self.$.arbeitgeber.focusAction();
    						self.$.angelegt.focusAction();
    						self.$.bearbeitet.focusAction();
    					}
    					else
    					{
    						console.log(JSON.stringify(api));
    					}
    				});
    				model.webService.getAllDozentFaecher(zeigeDozent, function(api) {
    					if (!api.error)
    					{
    						self.dozentenfaecher = api.response;
    					}
    					else
    					{
    						console.log(JSON.stringify(api));
    					}
    				});
    				model.webService.getAllFaecher(function(api) {
    					if (!api.error)
    					{
    						self.faecher = api.response;
    						var i;
    						for (i = 0; i < self.dozentenfaecher.length; i++)
    						{
        						var ii;
    							for (ii = 0; ii < self.faecher.length; ii++)
    							{
    								if (self.dozentenfaecher[i].id === self.faecher[ii].id)
    								{
    									self.faecher.splice(ii, 1);
    								}
    							}
    						}
    					}
    					else
    					{
    						console.log(JSON.stringify(api));
    					}
    				});	
    			}
    			self.status = zeigeDozent.StatusEnum.all;
    			self.geschlecht = zeigeDozent.GeschlechtEnum.all;		
    		},
    		anlegen: function()
    		{
    			var self = this;
    			model.webService.createDozent(self.dozent, function(api) {
   				if (!api.error)
				{
					console.log(JSON.stringify(api));
					var i;
					for (i = 0; i < faecher.length; i++)
					{
						self.fach = faecher[i];
						model.webService.setDozentFach(self.dozent, self.fach, function(api) {
							console.log(JSON.stringify(api));
						});
					}
				}
				else
				{
					console.log(JSON.stringify(api));
				}
	    		});
    			
    		},
			addFach: function()
			{
				var self = this;
				var zeigeDozent = new model.templates.Dozent();
				zeigeDozent.id = 1; // muss noch durch Data Binding ersetzt werden
				model.webService.setDozentFach(zeigeDozent, self.faecher[self.$.fach.selected], function(api) {
					if (!api.error)
					{
						console.log(JSON.stringify(api));
						self.dozentenfaecher.push(self.faecher[self.$.fach.selected]);
					}
					else
					{
						console.log(JSON.stringify(api));
					}
				});
			},
			deleteFach: function(e)
			{
				var self = this;
				var zeigeDozent = new model.templates.Dozent();
				zeigeDozent.id = 1; // muss noch durch Data Binding ersetzt werden
				var fach = e.target.templateInstance.model.item;
				model.webService.deleteDozentFach(zeigeDozent, fach, function(api) {
					if (!api.error)
					{
						console.log(JSON.stringify(api));
						var i;
						for (i = 0; i < self.dozentenfaecher.length; i++)
						{
							if (self.dozentenfaecher[i].id === fach.id)
							{
								self.dozentenfaecher.splice(i, 1);
							}
						}
					}
					else
					{
						console.log(JSON.stringify(api));
					}
				});
			},
	    	speichern: function()
	    	{
	    		var self = this;
	    		var newDozent = new model.templates.Dozent();
	    		newDozent = self.dozent;
	    		model.webService.updateDozent(newDozent, function(api) {
	    			console.log(JSON.stringify(api));
	    		});
	    	},
			loeschen: function()
			{
				var self = this;
	    		var newDozent = new model.templates.Dozent();
	    		newDozent = self.dozent;
	    		model.webService.deleteDozent(newDozent, function(api) {
	    			if (!api.error)
					{
						console.log(JSON.stringify(api));
						var i;
						for (i = 0; i < faecher.length; i++)
						{
							self.fach = faecher[i];
							model.webService.seteDozentFach(self.dozent, self.fach, function(api) {
								console.log(JSON.stringify(api));
							});
						}
					}
					else
					{
						console.log(JSON.stringify(api));
					}
	    		});
			},
	    	abbrechen: function()
	    	{
	    	
	    	}
 		});
		
	 </script>
</polymer-element>