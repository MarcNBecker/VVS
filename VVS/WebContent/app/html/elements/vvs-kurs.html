<polymer-element name="vvs-kurs">
	<template>
 		<link rel="stylesheet" href="../../css/elements.css" shim-shadowdom>
		<core-media-query query="max-width: 1400px" queryMatches="{{smallScreen}}"></core-media-query>
		<!-- Main DIV -->
		<paper-shadow z="3" class="shadow">
		<div vertical?="{{smallScreen}}" horizontal?="{{!smallScreen}}" layout>
			<!-- Kurs und Kurssprecher Input Fields -->
			<div auto-vertical?="{{smallScreen}}" flex?="{{!smallScreen}}" two?="{{!smallScreen}}">
				<!-- Input Fields Kurs -->
				<div vertical layout class="vertical-input">
					<span class="headline">Kurs</span>
					<div horizontal start layout class="horizontal-input">
						<paper-input-decorator id="kursname" label="Kursname" error="Pflichtfeld" floatingLabel autoValidate isInvalid="{{invalid.kursname}}" flex>
							<input is="core-input" type="text" value={{kurs.kursname}} maxlength="100" required disabled?="{{disableToggle}}">
						</paper-input-decorator>						
						<paper-dropdown-menu label="Studiengangsleiter" disabled?="{{disableToggle}}" self-center flex>
							<paper-dropdown class="dropdown">
								<core-menu class="menu" selected="{{selectedStudiengangsleiter}}">
								<template repeat="{{item in studiengangsleiter}}">
									<paper-item>{{item.name}}</paper-item>
								</template>
							</core-menu>
							</paper-dropdown>
						</paper-dropdown-menu>						
						<paper-input-decorator id="sekretariatName" label="Sekretariat" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.sekretariatName}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
					</div>
					<div horizontal start layout class="horizontal-input">
						<paper-input-decorator id="studentenAnzahl" label="Anzahl Studenten" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.studentenAnzahl}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-input-decorator id="kursmail" label="Kurs E-Mail-Adresse" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.kursmail}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>					
						<paper-dropdown-menu label="Modulplan" disabled?="{{disableToggle}}" self-center flex>
							<paper-dropdown class="dropdown">
								<core-menu class="menu" selected="{{selectedModulplan}}">
								<template repeat="{{item in modulplaene}}">
									<paper-item>
										{{item.studiengang}}-{{item.vertiefungsrichtung}}
									</paper-item>
								</template>
							</core-menu>
							</paper-dropdown>
						</paper-dropdown-menu>
					</div>
			 	</div>
				<!-- Input Fields Kurssprecher -->
				<div vertical layout class="vertical-input">
					<span class="headline">Kurssprecher</span>
					<div horizontal start layout class="horizontal-input">
						<paper-input-decorator id="kurssprecherVorname" label="Vorname" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.kurssprecherVorname}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-input-decorator id="kurssprecherName" label="Nachname" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.kurssprecherName}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-input-decorator id="kurssprecherMail" label="E-Mail-Adresse" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.kurssprecherMail}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-input-decorator id="kurssprecherTelefon" label="Telefonnummer" floatingLabel flex>
							<input is="core-input" type="text" value={{kurs.kurssprecherTelefon}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
					</div>
				</div>
			</div>
			<!-- Blocklagen Input Fields -->
			<div auto-vertical?="{{smallScreen}}" flex?="{{!smallScreen}}">
				<!-- Input Fields -->
				<div vertical layout class="vertical-input">
					<span class="headline">Blocklagen</span>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker1a" relatedTarget="{{$.von1a.input}}" relatedInput="von1a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von1a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von1a" label="1. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker1a" floatingLabel flex>
							<input is="core-input" value="{{blocklage1.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker1b" relatedTarget="{{$.bis1b.input}}" relatedInput="bis1b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis1b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis1b" label="1. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker1b" floatingLabel flex>
							<input is="core-input" value="{{blocklage1.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum1" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage1.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker2a" relatedTarget="{{$.von2a.input}}" relatedInput="von2a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von2a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von2a" label="2. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker2a" floatingLabel flex>
							<input is="core-input" value="{{blocklage2.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker2b" relatedTarget="{{$.bis2b.input}}" relatedInput="bis2b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis2b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis2b" label="2. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker2b" floatingLabel flex>
							<input is="core-input" value="{{blocklage2.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum2" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage2.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker3a" relatedTarget="{{$.von3a.input}}" relatedInput="von3a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von3a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von3a" label="3. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker3a" floatingLabel flex>
							<input is="core-input" value="{{blocklage3.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker3b" relatedTarget="{{$.bis3b.input}}" relatedInput="bis3b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis1b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis3b" label="3. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker3b" floatingLabel flex>
							<input is="core-input" value="{{blocklage3.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum3" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage3.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker4a" relatedTarget="{{$.von4a.input}}" relatedInput="von4a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von4a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von4a" label="4. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker4a" floatingLabel flex>
							<input is="core-input" value="{{blocklage4.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker4b" relatedTarget="{{$.bis4b.input}}" relatedInput="bis4b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis4b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis4b" label="4. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker4b" floatingLabel flex>
							<input is="core-input" value="{{blocklage4.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum4" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage4.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker5a" relatedTarget="{{$.von5a.input}}" relatedInput="von5a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von5a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von5a" label="5. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker5a" floatingLabel flex>
							<input is="core-input" value="{{blocklage5.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker5b" relatedTarget="{{$.bis5b.input}}" relatedInput="bis5b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis5b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis5b" label="5. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker5b" floatingLabel flex>
							<input is="core-input" value="{{blocklage5.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum5" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage5.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
					<div horizontal start layout class="horizontal-input">
						<polymer-date-picker id="datePicker6a" relatedTarget="{{$.von6a.input}}" relatedInput="von6a" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.von6a.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="von6a" label="6. Blocklage von" on-click="{{toggle}}" relatedDatePicker="datePicker6a" floatingLabel flex>
							<input is="core-input" value="{{blocklage6.startDatum}}">
						</paper-input-decorator>
						<polymer-date-picker id="datePicker6b" relatedTarget="{{$.bis6b.input}}" relatedInput="bis6b" on-click="{{toggle2}}" halign="left" style="z-index:99" selectedDate="{{$.bis6b.input.value}}" opened="false"></polymer-date-picker>
						<paper-input-decorator id="bis6b" label="6. Blocklage bis" on-click="{{toggle}}" relatedDatePicker="datePicker6b" floatingLabel flex>
							<input is="core-input" value="{{blocklage6.endDatum}}">
						</paper-input-decorator>
						<paper-input-decorator id="raum6" label="Raum" floatingLabel flex>
							<input is="core-input" type="text" value={{blocklage6.raum}} maxlength="100" disabled?="{{disableToggle}}">
						</paper-input-decorator>
						<paper-icon-button on-click="{{print}}" icon="print" horizontal layout center self-center></paper-icon-button>
					</div>
				</div>
				<!-- Button Bar -->
					<div horizontal layout center class="horizontal-input">
						<div hidden?={{creationMode}} horizontal layout center class="horizontal-button-bar">
							<paper-button on-click={{update}} raised disabled?="{{disableToggle}}">Speichern</paper-button>
							<paper-button on-click={{initDelete}} raised disabled?="{{disableToggle}}">L&ouml;schen</paper-button>
							<paper-button on-click={{cancel}} raised disabled?="{{disableToggle}}">Abbrechen</paper-button>				
							<paper-spinner active?={{disableToggle}} self-center></paper-spinner>
						</div>
						<div hidden?="{{!creationMode}}" horizontal layout center class="horizontal-button-bar">
							<paper-button on-click={{create}} raised disabled?="{{disableToggle}}">Anlegen</paper-button>
							<paper-button on-click={{cancel}} raised disabled?="{{disableToggle}}">Abbrechen</paper-button>
							<paper-spinner active?={{disableToggle}} self-center></paper-spinner>
						</div>
					</div>
			</div>
		</div>
		</paper-shadow>
		<paper-action-dialog id="delete_kurs_dialog" heading="{{kurs.kursname}} wirklich l&ouml;schen?">
			<paper-button affirmative>Nein</paper-button>
			<paper-button on-click="{{doDelete}}" affirmative autofocus>L&ouml;schen</paper-button>
		</paper-action-dialog>
	</template>
	<script type="text/javascript" src="../../js/model.js"></script>
	<script type="text/javascript">
		Polymer('vvs-kurs', {
			modulplaene: [],
			studiengangsleiter: [],
			blocklagen: [],
			blocklage1: new model.templates.Blocklage(),
			blocklage2: new model.templates.Blocklage(),
			blocklage3: new model.templates.Blocklage(),
			blocklage4: new model.templates.Blocklage(),
			blocklage5: new model.templates.Blocklage(),
			blocklage6: new model.templates.Blocklage(),
			kurs: new model.templates.Kurs(),
			selectedModulplan : -1,
			selectedStudiengangsleiter : -1,
			creationMode: true,
			invalid: {},
			//Publish those attributes to home
			publish: {
				pageParameter: {},
				pageLoaded: {},
				toasts: {}
			},
			//Initialize the screen
    		ready: function() {
    			var self = this;
    			self.modulplaene = [];
    			self.studiengangsleiter = [];
    			self.blocklagen = [];
    			self.blocklage1 = new model.templates.Blocklage();
    			self.blocklage2 = new model.templates.Blocklage();
    			self.blocklage3 = new model.templates.Blocklage();
    			self.blocklage4 = new model.templates.Blocklage();
    			self.blocklage5 = new model.templates.Blocklage();
    			self.blocklage6 = new model.templates.Blocklage();
    			self.kurs = new model.templates.Kurs();
    			self.selectedModulplan = -1;
    			self.selectedStudiengangsleiter = -1;
    			self.creationMode = true;
    			self.invalid = {};
    			var showKurs = new model.templates.Kurs();
    			showKurs.id = self.pageParameter.kurs.id;
    			//Go to creation mode
    			if (showKurs.id === 0)
    			{
					//Load available Studiengangsleiter
    				model.webService.getAllStudiengangsleiter(function(api) {
						if (!api.isError) {
							self.studiengangsleiter = api.response;						
						}
						else{
							console.log(JSON.stringify(api));
							self.toasts.error.show();
						}
					});
    				//Load available Modulplaene
    				model.webService.getAllModulplaene(function(api) {
    					if (!api.isError)
    					{
    						self.modulplaene = api.response;
    						//Enable buttons and force correct input label display
    						self.disableToggle = false;
    						self.invalid.kursname = true;
    						self.invalid.von1a = false;
    						self.invalid.bis1b = false;
    						self.invalid.von2a = false;
    						self.invalid.bis2b = false;
    						self.invalid.von3a = false;
    						self.invalid.bis3b = false;    
    						self.invalid.von4a = false;
    						self.invalid.bis4b = false;    
    						self.invalid.von5a = false;
    						self.invalid.bis5b = false;    
    						self.invalid.von6a = false;
    						self.invalid.bis6b = false;    
    						}
    					else
    					{
    						console.log(JSON.stringify(api));
    						self.toasts.error.show();
    					}
    				});
    				//Refresh blocklagen dates
					self.job("von1a-commit", function() {
						self.$.von1a.input.commit();
						},100);
					self.job("bis1b-commit", function() {
						self.$.bis1b.input.commit();
						},100);
					self.job("von2a-commit", function() {
						self.$.von2a.input.commit();
						},100);
					self.job("bis2b-commit", function() {
						self.$.bis2b.input.commit();
						},100);
					self.job("von3a-commit", function() {
						self.$.von3a.input.commit();
						},100);
					self.job("bis3b-commit", function() {
						self.$.bis3b.input.commit();
						},100);
					self.job("von4a-commit", function() {
						self.$.von4a.input.commit();
						},100);
					self.job("bis4b-commit", function() {
						self.$.bis4b.input.commit();
						},100);
					self.job("von5a-commit", function() {
						self.$.von5a.input.commit();
						},100);
					self.job("bis5b-commit", function() {
						self.$.bis5b.input.commit();
						},100);
					self.job("von6a-commit", function() {
						self.$.von6a.input.commit();
						},100);
					self.job("bis6b-commit", function() {
						self.$.bis6b.input.commit();
						},100);
    			}
    			//Go to edit mode
    			else
    			{
					this.creationMode = false;
    				model.webService.getKurs(showKurs, function(api) {
						if (!api.isError) {
							self.kurs = api.response;
							//Get all available Studiengangsleiter
							model.webService.getAllStudiengangsleiter(function(api) {
								if (!api.isError) {
									self.studiengangsleiter = api.response;
									var i;
									for(i = 0; i<self.studiengangsleiter.length; i++) {
										if (self.studiengangsleiter[i].id === self.kurs.studiengangsleiterID) {
											self.selectedStudiengangsleiter = i;
											break;
										}
									}
								}
								else{
									console.log(JSON.stringify(api));
									self.toasts.error.show();
								}
							});
							//Get all available Modulplaene
							model.webService.getAllModulplaene(function(api){
								if (!api.isError) {	
									self.modulplaene = api.response;
									var i;
									for(i = 0; i<self.modulplaene.length; i++) {
										if (self.modulplaene[i].id === self.kurs.modulplanID) {
											self.selectedModulplan = i;
											break;
										}
									}
								}
								else{
									console.log(JSON.stringify(api));
									self.toasts.error.show();
								}
							});
							//Initialize input fields and make them display correctly
							self.job('update-labels-ready', function() {
								self.$.kursname.inputAction();
								self.$.sekretariatName.inputAction();
								self.$.studentenAnzahl.inputAction();
								self.$.kurssprecherName.inputAction();
								self.$.kurssprecherVorname.inputAction();
								self.$.kurssprecherTelefon.inputAction();
								self.$.kurssprecherMail.inputAction();
								self.$.kursmail.inputAction();	
								self.$.raum1.inputAction();
								self.$.raum2.inputAction();
								self.$.raum3.inputAction();
								self.$.raum4.inputAction();
								self.$.raum5.inputAction();
								self.$.raum6.inputAction();
							},100);
						}					
						else{
							console.log(JSON.stringify(api));
							self.toasts.error.show();
						}					
					});
    				//Get all available Blocklagen des Kurses
					model.webService.getAllKursBlocklagen(showKurs, function(api) {
						if(!api.isError) {
							self.blocklagen = api.response;
							var i;
							//Set data of Blocklagen to local blocklagen and commit values
							for(i = 0; i < self.blocklagen.length; i++) {
								switch(self.blocklagen[i].semester) {
								case 1:
									self.blocklage1 = self.blocklagen[i];
									self.job("von1a-commit", function() {
										self.$.von1a.input.commit();
										},100);
									self.job("bis1b-commit", function() {
										self.$.bis1b.input.commit();
										},100);
									break;
								case 2:
									self.blocklage2 = self.blocklagen[i];
									self.job("von2a-commit", function() {
										self.$.von2a.input.commit();
										},100);
									self.job("bis2b-commit", function() {
										self.$.bis2b.input.commit();
										},100);
									break;
								case 3:
									self.blocklage3 = self.blocklagen[i];
									self.job("von3a-commit", function() {
										self.$.von3a.input.commit();
										},100);
									self.job("bis3b-commit", function() {
										self.$.bis3b.input.commit();
										},100);
									break;
								case 4:
									self.blocklage4 = self.blocklagen[i];
									self.job("von4a-commit", function() {
										self.$.von4a.input.commit();
										},100);
									self.job("bis4b-commit", function() {
										self.$.bis4b.input.commit();
										},100);
									break;
								case 5:
									self.blocklage5 = self.blocklagen[i];
									self.job("von5a-commit", function() {
										self.$.von5a.input.commit();
										},100);
									self.job("bis5b-commit", function() {
										self.$.bis5b.input.commit();
										},100);
									break;
								case 6:
									self.blocklage6 = self.blocklagen[i];
									self.job("von6a-commit", function() {
										self.$.von6a.input.commit();
										},100);
									self.job("bis6b-commit", function() {
										self.$.bis6b.input.commit();
										},100);
									break;
								default:
									break;
								}
							}
						}
						else{
							console.log(JSON.stringify(api));
							self.toasts.error.show();
						}
					});
    			}
    		},
    		//create a new Kurs
    		create: function()
    		{
    			var self = this;
    			//Refresh blocklagen dates
    			self.$.von1a.inputAction();
				self.$.bis1b.inputAction();
				self.$.von2a.inputAction();
				self.$.bis2b.inputAction();
				self.$.von3a.inputAction();
				self.$.bis3b.inputAction();  
				self.$.von4a.inputAction();
				self.$.bis4b.inputAction();  
				self.$.von5a.inputAction();
				self.$.bis5b.inputAction();   
				self.$.von6a.inputAction();
				self.$.bis6b.inputAction(); 
    			if(!this.checkInputs()) {
    				return;
    			}
    			//Disable everything
    			self.disableToggle = true;
    			//Create Kurs
    			//Set IDs of Studiengangsleiter and Modulplan
    			self.kurs.studiengangsleiterID = self.studiengangsleiter[self.selectedStudiengangsleiter].id;
    			self.kurs.modulplanID = self.modulplaene[self.selectedModulplan].id;
    			model.webService.createKurs(self.kurs, function(api) {
	   				if (!api.isError)
					{
						self.kurs = api.response;
						//Tell the outside world about the new ID
						self.pageLoaded.stammdaten = false;
						window.history.replaceState({}, '', '#!kurs-'+self.kurs.id);
						//Set data for blocklagen and append them to blocklagen[]
						self.blocklage1.kursID = self.kurs.id;
						self.blocklage1.semester = 1;
						self.blocklage1.startDatum = self.$.von1a.input.value;
						self.blocklage1.endDatum = self.$.bis1b.input.value;
						self.blocklagen.push(self.blocklage1);
						self.blocklage2.kursID = self.kurs.id;
						self.blocklage2.semester = 2;
						self.blocklage2.startDatum = self.$.von2a.input.value;
						self.blocklage2.endDatum = self.$.bis2b.input.value;
						self.blocklagen.push(self.blocklage2);
						self.blocklage3.kursID = self.kurs.id;
						self.blocklage3.semester = 3;
						self.blocklage3.startDatum = self.$.von3a.input.value;
						self.blocklage3.endDatum = self.$.bis3b.input.value;
						self.blocklagen.push(self.blocklage3);
						self.blocklage4.kursID = self.kurs.id;
						self.blocklage4.semester = 4;
						self.blocklage4.startDatum = self.$.von4a.input.value;
						self.blocklage4.endDatum = self.$.bis4b.input.value;
						self.blocklagen.push(self.blocklage4);
						self.blocklage5.kursID = self.kurs.id;
						self.blocklage5.semester = 5;
						self.blocklage5.startDatum = self.$.von5a.input.value;
						self.blocklage5.endDatum = self.$.bis5b.input.value;
						self.blocklagen.push(self.blocklage5);
						self.blocklage6.kursID = self.kurs.id;
						self.blocklage6.semester = 6;
						self.blocklage6.startDatum = self.$.von6a.input.value;
						self.blocklage6.endDatum = self.$.bis6b.input.value;
						self.blocklagen.push(self.blocklage6);
						var i;
						var deepRuns = 0;
						//Create connection between Kurs and Blocklagen
						for (i = 0; i < self.blocklagen.length; i++)
						{
							model.webService.setKursBlocklage(self.blocklagen[i], function(api) {
								if (!api.isError)
								{
									deepRuns++;
									//Enable buttons and display new button bar after last webservice call
									if(deepRuns === self.blocklagen.length) {
										self.disableToggle = false;
										self.creationMode = false;
				    					self.toasts.success.show();
									}
								}
								else
								{
									console.log(JSON.stringify(api));
									self.toasts.error.show();
								}
							});
						}
						//Enable buttons and display new button bar after last webservice call
						if (deepRuns === 0 && self.blocklagen.length === 0) {
							self.disableToggle = false;
							self.creationMode = false;
	    					self.toasts.success.show();
						}
					}
					else
					{
						console.log(JSON.stringify(api));
						self.toasts.error.show();
					}
	    		});
    			
    		},
    		//Update a Kurs
    		update: function() {
       			var self = this;
       			//Refresh blocklagen dates
    			self.$.von1a.inputAction();
				self.$.bis1b.inputAction();
				self.$.von2a.inputAction();
				self.$.bis2b.inputAction();
				self.$.von3a.inputAction();
				self.$.bis3b.inputAction();  
				self.$.von4a.inputAction();
				self.$.bis4b.inputAction();  
				self.$.von5a.inputAction();
				self.$.bis5b.inputAction();   
				self.$.von6a.inputAction();
				self.$.bis6b.inputAction(); 
				if(!this.checkInputs()) {
    				return;
    			}
    			//Disable everything
    			self.disableToggle = true;
    			//Update Kurs
    			//Set IDs of Studiengangsleiter and Modulplan
    			self.kurs.studiengangsleiterID = self.studiengangsleiter[self.selectedStudiengangsleiter].id;
    			self.kurs.modulplanID = self.modulplaene[self.selectedModulplan].id;
    			model.webService.updateKurs(self.kurs, function(api) {
	   				if (!api.isError)
					{
	   					//Set data for blocklagen and append them to blocklagen[]
	   					self.blocklage1.kursID = self.kurs.id;
						self.blocklage1.semester = 1;
						self.blocklage1.startDatum = self.$.von1a.input.value;
						self.blocklage1.endDatum = self.$.bis1b.input.value;
						self.blocklagen.push(self.blocklage1);
						self.blocklage2.kursID = self.kurs.id;
						self.blocklage2.semester = 2;
						self.blocklage2.startDatum = self.$.von2a.input.value;
						self.blocklage2.endDatum = self.$.bis2b.input.value;
						self.blocklagen.push(self.blocklage2);
						self.blocklage3.kursID = self.kurs.id;
						self.blocklage3.semester = 3;
						self.blocklage3.startDatum = self.$.von3a.input.value;
						self.blocklage3.endDatum = self.$.bis3b.input.value;
						self.blocklagen.push(self.blocklage3);
						self.blocklage4.kursID = self.kurs.id;
						self.blocklage4.semester = 4;
						self.blocklage4.startDatum = self.$.von4a.input.value;
						self.blocklage4.endDatum = self.$.bis4b.input.value;
						self.blocklagen.push(self.blocklage4);
						self.blocklage5.kursID = self.kurs.id;
						self.blocklage5.semester = 5;
						self.blocklage5.startDatum = self.$.von5a.input.value;
						self.blocklage5.endDatum = self.$.bis5b.input.value;
						self.blocklagen.push(self.blocklage5);
						self.blocklage6.kursID = self.kurs.id;
						self.blocklage6.semester = 6;
						self.blocklage6.startDatum = self.$.von6a.input.value;
						self.blocklage6.endDatum = self.$.bis6b.input.value;
						self.blocklagen.push(self.blocklage6);
						var i;
						var deepRuns = 0;
						//Create connection between Kurs and Blocklagen
						for (i = 0; i < self.blocklagen.length; i++)
						{
							model.webService.setKursBlocklage(self.blocklagen[i], function(api) {
								if (!api.isError)
								{
									deepRuns++;
									//Enable buttons and display new button bar after last webservice call
									if(deepRuns === self.blocklagen.length) {
										self.disableToggle = false;
										self.creationMode = false;
				    					self.toasts.success.show();
									}
								}
								else
								{
									console.log(JSON.stringify(api));
									self.toasts.error.show();
								}
							});
						}
						//Enable buttons and display new button bar after last webservice call
						if (deepRuns === 0 && self.blocklagen.length === 0) {
							self.disableToggle = false;
							self.creationMode = false;
	    					self.toasts.success.show();
						}
					}
					else
					{
						console.log(JSON.stringify(api));
						self.toasts.error.show();
					}
	    		});
    		},
    		// Show Action Dialog for Deletion
    		initDelete: function() {
	    		this.$.delete_kurs_dialog.toggle();
	    	},
	    	//Delete a kurs
			doDelete: function()
			{
				var self = this;
				//Disable inputs
				self.disableToggle = true;
				//Delete the Kurs
	    		model.webService.deleteKurs(self.kurs, function(api) {
					if(!api.isError) {
						//Update variables and switch display of button bar
						self.kurs = new model.templates.Kurs();
						//Tell the outside world the new ID
						self.pageLoaded.stammdaten = false;
						window.history.replaceState({}, '', '#!kurs');
						self.modulplaene = [];
		    			self.studiengangsleiter = [];
		    			self.blocklagen = [];
		    			self.blocklage1 = new model.templates.Blocklage();
		    			self.blocklage2 = new model.templates.Blocklage();
		    			self.blocklage3 = new model.templates.Blocklage();
		    			self.blocklage4 = new model.templates.Blocklage();
		    			self.blocklage5 = new model.templates.Blocklage();
		    			self.blocklage6 = new model.templates.Blocklage();
		    			self.disableToggle = false;
		    			self.selectedModulplan = -1;
		    			self.selectedStudiengangsleiter = -1;
		    			self.creationMode = true;
    					self.invalid.kursname = true;
						self.invalid.von1a = false;
						self.invalid.bis1b = false;
						self.invalid.von2a = false;
						self.invalid.bis2b = false;
						self.invalid.von3a = false;
						self.invalid.bis3b = false;    
						self.invalid.von4a = false;
						self.invalid.bis4b = false;    
						self.invalid.von5a = false;
						self.invalid.bis5b = false;    
						self.invalid.von6a = false;
						self.invalid.bis6b = false;   
						self.job('update-labels-delete', function() {
							self.$.kursname.inputAction();
							self.$.sekretariatName.inputAction();
							self.$.studentenAnzahl.inputAction();
							self.$.kurssprecherName.inputAction();
							self.$.kurssprecherVorname.inputAction();
							self.$.kurssprecherTelefon.inputAction();
							self.$.kurssprecherMail.inputAction();
							self.$.kursmail.inputAction();	
							self.$.raum1.inputAction();
							self.$.raum2.inputAction();
							self.$.raum3.inputAction();
							self.$.raum4.inputAction();
							self.$.raum5.inputAction();
							self.$.raum6.inputAction();
						}, 100);
						self.toasts.success.show();
					} else {
						console.log(JSON.stringify(api));
						self.toasts.error.show();
					}
	    		});
			},
    		//Navigate backwards and force a reload
	    	cancel: function()
	    	{
	    		this.pageLoaded.kurs = false;
	    		window.history.back();
	    	},
			//Print Vorlesungsplan
			print: function (e, detail, sender) {
				// TODO
			},
	    	//Close DatePicker
			toggle2: function(e, detail, sender) {
				var input = sender.getAttribute("relatedInput");
				//If new date selected, close DatePicker and commit selected date
				if (this.shadowRoot.querySelector("#" + input).input.committedValue !== this.blocklage1.startDatum)
				{
					var datePicker = sender.getAttribute("id");
					this.shadowRoot.querySelector("#" + datePicker).toggle();
					this.job("von1a-commit", function() {
						this.shadowRoot.querySelector("#" + input).input.commit();
					},100);
				}
			},
			//Show DatePicker
			toggle: function(e, detail, sender) {
				var self = this;
				//Set DatePicker-Date to today
				if (!sender.input.value) {
					sender.input.value = this.formateDate();
					sender.input.commit();
				}
				self.job("datePicker-data", function() {
					var datePicker = sender.getAttribute("relatedDatePicker");
					self.shadowRoot.querySelector("#" + datePicker).toggle();
				},500);
			},
			//Calculate date of today
			formateDate: function() {
			    var date = new Date();
				var year = date.getFullYear();
			    var month = '0' + (date.getMonth() + 1);
			    month = month.slice(-2, (month.length - 2) + 3);
			    var day = '0' + date.getDate();
			    day = day.slice(-2, (day.length - 2) + 3);
			    return year + '-' + month + '-' + day;
			},
			//Check all invalid properties
			checkInputs : function() {
				for(var property in this.invalid) {
					if(this.invalid.hasOwnProperty(property)) {
						if(this.invalid[property] === true) {
							return false;
						}
					}
				}
				return true;
			}
 		});
	 </script>
</polymer-element>
