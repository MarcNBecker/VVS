<polymer-element name="vvs-modulplan-anlegen">
	<template>
		<link rel="stylesheet" href="../../css/elements.css" shim-shadowdom>
		<div>
			<!-- Main input fields -->
			<paper-input-decorator id="modulplan" label="Modulplan" labelVisible floatingLabel>
				<input is="core-input" value={{modulplan.studiengang}} on-keyup={{checkButton}}>
			</paper-input-decorator>
			<paper-input-decorator id="vertiefungsrichtung" label="Vertiefungsrichtung" labelVisible floatingLabel>
				<input is="core-input" value={{modulplan.vertiefungsrichtung}} on-keyup={{checkButton}}>
			</paper-input-decorator>	
			<p style="float: left; padding-top: 7px;">Vorlage verwenden:</p>
			<paper-checkbox id="checkboxVorlage" checked={{vorlageChecked}} on-click={{enableDropdown}} style="float: left; margin-top: 25px; margin-right: 10px; margin-left: 10px;"></paper-checkbox>
			<paper-dropdown-menu id="dropdownVorlage" style="float: left; " label="Vorlage" disabled={{vorlagenDisabled}} >
				<paper-dropdown class="dropdown">
					<core-menu selected={{selectedVorlage}} class="menu"  id="vorlage" on-click={{checkButton}}>
						<template  repeat="{{item in vorlagen}}">
							<paper-item>{{item.studiengang}}-{{item.vertiefungsrichtung}}</paper-item>
						</template>
					</core-menu>
				</paper-dropdown>
			</paper-dropdown-menu>
		</div>
		<div style="clear:both;"></div>
		<br /><br />
		<!-- Button Bar -->
		<div style="text-align: center;">
			<paper-button on-click="{{create}}" disabled={{buttonDisabled}} raised>Modulplan anlegen</paper-button>
		</div>
		<!-- Toasts -->
		<paper-toast id="toast_success" text="Erfolgreich ausgef&uuml;hrt"></paper-toast>
		<paper-toast id="toast_error" text="Leider ist ein Fehler aufgetreten. Bitte laden Sie die Seite neu!" duration="15000">
			<core-icon-button icon="refresh" on-click={{refresh}}></core-icon-button>
		</paper-toast>
	</template>
	<script>
		Polymer("vvs-modulplan-anlegen", {
			//Initializing
			vorlagenDisabled: true,
			buttonDisabled: true,
			modulplan: new model.templates.Modulplan(),
			vorlageChecked: false,
			selectedVorlage: null,
			vorlagen: [],
			//Initialize the screen
			ready: function()
			{
				var self = this;		
				//Load available Modulplaene
				model.webService.getAllModulplaene(function(api)
				{
					if (!api.error)
					{
						self.vorlagen = api.response;
					}
					else
					{
						console.log(JSON.stringify(api));
						self.$.toast_error.show();
					}
				});
			},
			//create a new Modulplan
			create: function()
			{
    			var self = this;
    			// If Vorlage is selected, set ID
    			if (self.$.vorlage.selected !== null)
				{
    				modulplan.vorlage = self.vorlagen[self.$.vorlage.selected].id;
				}
    			//Create Modulplan
    			model.webService.createModulplan(modulplanNew, function(api)
    					{
					if (!api.error)
					{
						self.modulplan = api.response;
						//Tell the outside world about the new ID
						self.modulplanID = self.modulplan.id;
						self.$.toast_sucess.show();
						//TODO Navigation zur nächsten Seite "Modulplan pflegen"
						
					}
					else
					{
    					console.log(JSON.stringify(api));
    					self.$.toast_error.show();
					}
				});
			},
			// Check if create-button should be disabled or not
			checkButton: function()
			{
				if((this.modulplan.studiengang !== "" && this.modulplan.vertiefungsrichtung !== "" && this.vorlageSelected && this.selectedVorlage !== null) ||(this.modulplan.studiengang !== "" && this.modulplan.vertiefungsrichtung !== "" && !this.vorlageSelected))
				{
					
					this.buttonDisabled = false;
				}
				else
				{
					this.buttonDisabled = true;
				}
			},
			// Check if dropdown with Vorlagen should be disabled or not
			enableDropdown: function()
			{
				if (!this.vorlageChecked)
				{
					this.vorlagenDisabled = false;
				}
				else
				{
					this.vorlagenDisabled = true;
					this.selectedVorlage = "";
				}
				// Check if create-button should be disabled or not
				if((this.modulplan.studiengang !== "" && this.modulplan.vertiefungsrichtung !== "" && this.vorlageSelected && this.selectedVorlage !== null) ||(this.modulplan.studiengang !== "" && this.modulplan.vertiefungsrichtung !== "" && !this.vorlageSelected))
				{
					
					this.buttonDisabled = false;
				}
				else
				{
					this.buttonDisabled = true;
				}
			}
		});
	</script>
</polymer-element>