<link rel="import" href="../../polymer/polymer/polymer.html">
<link rel="import" href="../../polymer/paper-elements/paper-elements.html">
<link rel="import" href="../../polymer/core-elements/core-elements.html">

<polymer-element name="vvs-modulplan-anlegen">
	<template>
		<link rel="stylesheet" type="text/css" href="../formate.css">
		<paper-input-decorator id="modulplan" label="Modulplan" labelVisible floatingLabel>
			<input is="core-input" value={{eingabeModulplan}} on-keyup={{checkForButton}}>
		</paper-input-decorator>
		<paper-input-decorator id="vertiefungsrichtung" label="Vertiefungsrichtung" labelVisible floatingLabel>
			<input is="core-input" value={{eingabeVertiefungsrichtung}} on-keyup={{checkForButton}}>
		</paper-input-decorator>	
		<p style="float: left; padding-top: 7px;">Vorlage verwenden:</p>
		<paper-checkbox id="checkboxVorlage" checked={{checkboxZustand}} on-click={{checkboxChanged}} style="float: left; margin-top: 25px; margin-right: 10px; margin-left: 10px;"></paper-checkbox>
		<paper-dropdown-menu id="dropdownVorlage" style="float: left; " label={{dropdownLabel}} disabled={{dropdownZustand}} >
			<paper-dropdown class="dropdown">
				<core-menu selected={{selectedVorlage}} class="menu"  id="vorlage" on-click={{dropdownSelected}}>
					<template  repeat="{{item in vorlagen}}">
						<paper-item>{{item.studiengang}}-{{item.vertiefungsrichtung}}</paper-item>
					</template>
				</core-menu>
			</paper-dropdown>
		</paper-dropdown-menu>		
		<div style="clear:both;"></div>
		<br /><br />
		<div style="text-align: center;">
			<paper-button on-click="{{modulplanAnlegen}}" disabled={{buttonZustand}} raised>Modulplan anlegen</paper-button>
		</div>
	</template>
	<script>
		Polymer("vvs-modulplan-anlegen", {
			dropdownZustand: true,
			buttonZustand: true,
			eingabeModulplan:"",
			eingabeVertiefungsrichtung:"",
			checkboxZustand: false,
			dropdownLabel: "Vorlage",
			selectedVorlage: null,
			vorlagen: [],
			ready: function() {
				var self = this;
				model.webService.getAllModulplaene(function(api) {
					if (!api.error)
					{
						self.vorlagen = api.response;
					}
					else
					{
						console.log(JSON.stringify(api));
					}
				});
			},
			modulplanAnlegen: function() {
    			var self = this;
    			var modulplanNew = new model.templates.Modulplan();
    			modulplanNew.studiengang = self.eingabeStudiengang;
    			modulplanNew.vertiefungsrichtung = self.eingabeVertiefungsrichtung;
    			if (self.$.vorlage.selected !== null)
				{
    				modulplanNew.vorlage = self.vorlagen[self.$.vorlage.selected].id;
				}
    			model.webService.createModulplan(modulplanNew, function(api) {
					if (!api.error)
					{
						var id = api.response.id;
						//TODO Navigation zur nächsten Seite "Modulplan pflegen"
					}
					else
					{
    					console.log(JSON.stringify(api));
					}
				});
			},
			checkboxChanged: function checkboxChanged(){		
				if (!this.checkboxZustandfalse)
				{
					this.dropdownZustand = false;	
				}
				else
				{
					this.dropdownZustand = true;
					this.dropdownLabel = "Vorlage";
					this.selectedVorlage = null;
					if(this.eingabeModulplan === "" || this.eingabeVertiefungsrichtung === "")
					{
						this.buttonZustand = true;
					}
				}
			},			
			dropdownSelected: function dropdownSelected(){
				if(this.eingabeModulplan === "" || this.eingabeVertiefungsrichtung === "")
				{
					this.buttonZustand = true;
				}
				else
				{
					this.buttonZustand = false;
				}
			},				
			checkForButton: function checkForButton()
			{
				if((this.eingabeModulplan !== "" && this.eingabeVertiefungsrichtung !== "" && this.checkboxZustand && this.selectedVorlage !== null) ||(this.eingabeModulplan !== "" && this.eingabeVertiefungsrichtung !== "" && !this.checkboxZustand))
				{
					
					this.buttonZustand = false;
				}
				else
				{
					this.buttonZustand = true;
				}
			},
		});
	</script>
</polymer-element>